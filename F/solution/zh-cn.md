{{ self.title() }}

## 算法

对序列进行分块，块大小为 $B$。

完整块的贡献：

对每个块，预处理块内的 $(i,a_i)$ 在不限制 $r$ 时对每个 $b_j$ 的贡献，需要 $O(B)$ 次矩形加，最后 $O(n)$ 次点查询，扫描线变为 $O(B)$ 次前缀加，$O(n)$ 次查单点。

对每次修改，考虑修改覆盖的 $O(\frac nB)$ 个完整块对区间内每个 $b_j$ 的贡献，维护块对点的贡献次数，需要1次矩形加；在查询时需要查一行的 $O(\frac nB)$ 个位置（即每个块对查询点的贡献）。

零散部分的贡献： 

对每次修改，还需要考虑前后的零散的 $B$ 个修改对所有点的贡献，需要 $O(B)$ 次矩形加，查询时1次查单点。

如果 $n,m$ 同阶，取 $B=\sqrt n$，以上问题都用标准技术处理，时间复杂度 $O(n^{\frac 32})$。
